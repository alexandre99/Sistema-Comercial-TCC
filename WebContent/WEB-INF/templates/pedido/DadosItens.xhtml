<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">


	<p:dataTable id="tableItens" reflow="true" var="itens"
		value="#{pedidoController.listaPedidoItem}" rowIndexVar="linha">

		<p:column headerText="Referência" style="text-align: center;"
			width="100">
			<h:outputText value="#{itens.produto.codigoBarras}"
				rendered="#{not itens.produtoNull}" />

			<p:inputText size="8" value="#{pedidoController.referencia}"
				label="Referência" id="referencia" rendered="#{itens.produtoNull}">
				<p:ajax event="change" process="@this"
					update="valorDesconto totalBruto valorLiquido tabViewItens"
					listener="#{pedidoController.setarProdutoNaListaItem}" />
			</p:inputText>
		</p:column>

		<p:column headerText="Descrição" style="text-align: center;"
			width="400">
			<h:outputText value="#{itens.produto.descricao}"
				rendered="#{not itens.produtoNull}" />

			<p:autoComplete id="idProduto" converter="produtoConverter"
				minQueryLength="3" forceSelection="true" maxResults="10"
				value="#{pedidoController.produto}" var="produto"
				itemLabel="#{produto.descricao}" itemValue="#{produto}"
				completeMethod="#{pedidoController.autoCompleteProduto}"
				queryDelay="500" rendered="#{itens.produtoNull}"
				onkeyup="strToUpper(this)">

				<p:ajax event="itemSelect" process="@this idProduto"
					update="valorDesconto totalBruto valorLiquido tabViewItens"
					listener="#{pedidoController.setarProdutoNaListaItem}" />

			</p:autoComplete>
		</p:column>

		<p:column headerText="Valor unitário" style="text-align: right"
			width="130">
			<h:outputText value="#{itens.valorUnitarioItem}">
				<f:convertNumber type="currency" />
			</h:outputText>
		</p:column>

		<p:column headerText="Qtd" style="text-align: center;">
			<p:inputNumber value="#{itens.quantidade}" maxlength="5"
				label="Quantidade" disabled="#{itens.produtoNull}">
				<p:ajax event="change" process="@this"
					update="tabViewItens valorDesconto totalBruto valorLiquido"
					listener="#{pedidoController.atualizarQuantidade(itens, linha)}" />
			</p:inputNumber>
		</p:column>

		<p:column headerText="Estoque" style="text-align: center;">
			<h:outputText value="#{itens.produto.quantidade}"
				style="#{itens.estoqueDisponivel ? '' : 'color: red'}">
				<f:convertNumber maxFractionDigits="2" />
			</h:outputText>

			<h:graphicImage library="sistemacomercialerp/images"
				name="alerta.png" id="semEstoque"
				style="vertical-align: top; margin-left: 5px"
				rendered="#{itens.estoqueIndisponivel}" />

			<p:tooltip for="semEstoque" value="Estoque insuficiente"
				rendered="#{itens.estoqueIndisponivel}" />

		</p:column>

		<p:column headerText="Valor total" style="text-align: right;"
			width="130">
			<h:outputText value="#{itens.valorTotalItem}">
				<f:convertNumber type="currency" />
			</h:outputText>
		</p:column>

		<p:columnGroup type="footer">
			<p:row>
				<p:column colspan="5" footerText="Subtotal"
					style="text-align: right" />
				<p:column style="text-align: right">
					<f:facet name="footer">
						<h:outputText value="#{pedidoController.pedido.valorBruto}">
							<f:convertNumber type="currency" />
						</h:outputText>
					</f:facet>
				</p:column>
			</p:row>
		</p:columnGroup>
	</p:dataTable>

</ui:composition>